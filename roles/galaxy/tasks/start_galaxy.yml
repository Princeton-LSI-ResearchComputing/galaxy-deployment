- name: start galaxy
  become: yes
  become_user: galaxy
  become_method: sudo
  shell: "{{ GALAXY_HOME }}/run.sh --daemon"

- name: wait for galaxy to start
  wait_for: port=8080 delay=5 state=started timeout=150

- name: Set 503 message to unplanned outage
  file: src={{ GALAXY_HOME }}/../www/html/error-documents/503_outage.html
        dest={{ GALAXY_HOME }}/../www/html/error-documents/503.html
        state=link

- name: start galaxy reports
  become: yes
  become_user: galaxy
  become_method: sudo
  shell: "{{ GALAXY_HOME }}/run_reports.sh --daemon"

- name: wait for galaxy reports to start
  wait_for: port=9001 delay=5 state=started timeout=150
