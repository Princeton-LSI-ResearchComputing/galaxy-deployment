 tools/plotting/bar_chart.xml             |    6 ++--
 tools/plotting/discard_stderr_wrapper.sh |   37 ++++++++++++++++++++++++++++++
 2 files changed, 40 insertions(+), 3 deletions(-)
 create mode 100755 tools/plotting/discard_stderr_wrapper.sh

diff --git a/tools/plotting/bar_chart.xml b/tools/plotting/bar_chart.xml
index 229ba41..054e2f9 100644
--- a/tools/plotting/bar_chart.xml
+++ b/tools/plotting/bar_chart.xml
@@ -1,8 +1,8 @@
 <tool id="barchart_gnuplot" name="Bar chart" version="1.0.0">
   <description>for multiple columns</description>
-  <command interpreter="python">
-    #if $xtic.userSpecified == "Yes" #bar_chart.py $input $xtic.xticColumn $colList "$title" "$ylabel" $ymin $ymax $out_file1 "$pdf_size"
-    #else                            #bar_chart.py $input 0 $colList "$title" "$ylabel" $ymin $ymax $out_file1 "$pdf_size"
+  <command interpreter="sh">discard_stderr_wrapper.sh
+    #if $xtic.userSpecified == "Yes" #python bar_chart.py $input $xtic.xticColumn $colList "$title" "$ylabel" $ymin $ymax $out_file1 "$pdf_size"
+    #else                            #python bar_chart.py $input 0 $colList "$title" "$ylabel" $ymin $ymax $out_file1 "$pdf_size"
     #end if
   </command>
   <inputs>
diff --git a/tools/plotting/discard_stderr_wrapper.sh b/tools/plotting/discard_stderr_wrapper.sh
new file mode 100755
index 0000000..642cff2
--- /dev/null
+++ b/tools/plotting/discard_stderr_wrapper.sh
@@ -0,0 +1,37 @@
+#!/bin/sh
+
+# STDERR wrapper - discards STDERR if command execution was OK.
+
+#
+# This script executes a given command line,
+# while saving the STDERR in a temporary file.
+#
+# When the command is completed, it checks to see if the exit code was zero.
+# if so - the command is assumed to have succeeded - the STDERR file is discarded.
+# if not - the command is assumed to have failed, and the STDERR file is dumped to the real STDERR
+#
+#
+# Use this wrapper for tools which insist on writting stuff to STDERR
+# even if they succeeded - which throws galaxy off balance.
+#
+#
+# Copyright 2009 (C) by Assaf Gordon
+# This file is distributed under the BSD license.
+#
+# Modified by Lance Parsons (2011)
+# Change directory to current directory to fix issues with galaxy barchart tool
+
+TMPFILE=$(mktemp -t tmp.XXXXXXXXXX) || exit 1
+CWD=`pwd`
+DIRECTORY=$(cd `dirname $0` && pwd)
+cd $DIRECTORY
+"$@" 2> $TMPFILE
+
+EXITCODE=$?
+# Exitcode != 0 ?
+if [ "$EXITCODE" -ne "0" ]; then
+	cat $TMPFILE >&2
+fi
+rm $TMPFILE
+cd $CWD
+exit $EXITCODE
